<!DOCTYPE html>
<link href="/static/category.css" rel="stylesheet">
<html lang="en">

<head>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $('select').formSelect();
        });

    </script>
    <script src="/static/project.js"></script>



    <meta charset="UTF-8">
</head>

<body>
    <div class="maincontainer">
        <div class="box" style="padding: 20px; width: 75%;">
            <div class="boxheading">
                <span class="headingtext">Product List</span>
                <span style="padding:3px;width:58%;display: flex;justify-content: flex-end"><a
                        href="http://localhost:8000/productinterface"><i class="material-icons"
                            style="color: #FFFFFF; font-size: 24px;">add_box</i></a></span>
            </div>

            <table class="striped">

                <thead>
                    <tr>
                        <th>Product Id</th>
                        <th>Category</th>
                        <th>Sub Category</th>
                        <th>Brand</th>
                        <th>Product Name</th>
                        <th>Price</th>
                        <th>Offer Price</th>
                        <th>Packing Type</th>
                        <th>Quantity</th>
                        <th>Status</th>
                        <th>Rating</th>
                        <th>Sale Status</th>
                        <th>Image</th>
                        <th>Update</th>
                    </tr>
                </thead>

                <tbody>
                    {% for row in records %}
                    <tr>
                        <td>{{row.productid}}</td>
                        <td>[{{row.categoryid}}] {{row.catname}}</td>
                        <td>[{{row.subcategoryid}}] {{row.subcatname}}</td>
                        <td>[{{row.brandid}}] {{row.brandname}}</td>
                        <td>{{row.productname}}</td>
                        <td>{{row.productprice}}</td>
                        <td>{{row.productofferprice}}</td>
                        <td>{{row.packingtype}}</td>
                        <td>{{row.quantity}}</td>
                        <td>{{row.productstatus}}</td>
                        <td>{{row.rating}}</td>
                        <td>{{row.productsalestatus}}</td>
                        <td><img class="imgbtn" 
                            producticon="{{row.producticon}}" 
                            productid="{{row.productid}}"
                            src="/static/{{row.producticon}}" 
                            width="40"></td>
                        <td><a 
                            bid="{{row.brandid}}" 
                            brandname="{{row.brandname}}" 
                            categoryname="{{row.catname}}"
                            cid="{{row.categoryid}}"
                            class="waves-effect waves-light btn modal-trigger editdeletebtn" href="#modal1"
                            offerprice="{{row.productofferprice}}" 
                            packingtype="{{row.packingtype}}"
                            price="{{row.productprice}}" 
                            productid="{{row.productid}}"
                            productname="{{row.productname}}" 
                            quantity="{{row.quantity}}" 
                            rating="{{row.rating}}"
                            salestatus="{{row.productsalestatus}}" 
                            sid="{{row.subcategoryid}}"
                            status="{{row.productstatus}}" 
                            subcategoryname="{{row.subcatname}}">Edit/Delete</a></td>
                    </tr>
                    {% endfor %}
                </tbody>

            </table>

        </div>
    </div>

    <!-- Modal Structure -->
    <div id="modal1" class="modal" style="max-height: 700px">
        <div class="modal-content">


            <input type="hidden" id="brandid" />
            <input type="hidden" id="subid" />
            <input type="hidden" id="productid" />

            <div class="modelbox">

                <div class="boxheading">
                    <span class="headingtextinterface">Product Interface</span>
                </div>

                <div style="margin-top: 10px;">

                    <div class="row">
                        <div class="input-field col s4">
                            <select id="categoryid" name="category_name">
                                <option disabled selected value="">Choose your Category</option>
                            </select>
                            <label for="categoryid">Category Name</label>
                        </div>

                        <div class="input-field col s4">
                            <select id="subcategoryid" name="subcategory_name">
                                <option disabled selected value="">Choose your Sub Category</option>
                            </select>
                            <label for="subcategoryid">Sub Category Name</label>
                        </div>

                        <div class="input-field col s4">
                            <select id="braid" name="brand_name">
                                <option disabled selected value="">Choose your Brand</option>
                            </select>
                            <label for="braid">Brand Name</label>
                        </div>
                    </div>

                    <div class="row">
                        <div class="input-field col s4">
                            <i class="material-icons prefix">account_circle</i>
                            <input class="validate" id="productname" name="productname" type="text">
                            <label for="Productname"></label>
                        </div>

                        <div class="input-field col s4">

                            <i class="material-icons prefix">attach_money</i>
                            <input class="validate" id="productprice" name="productprice" type="text">
                            <label for="productprice"></label>

                        </div>

                        <div class="input-field col s4">
                            <i class="material-icons prefix">money_off</i>
                            <input class="validate" id="productofferprice" name="productofferprice" type="text">
                            <label for="productofferprice"></label>
                        </div>
                    </div>

                    <div class="row">
                        <div class="input-field col s6">
                            <i class="material-icons prefix">assessment</i>
                            <input class="validate" id="quantity" name="quantity" type="text">
                            <label for="quantity"></label>
                        </div>

                        <div class="input-field col s6">
                            <i class="material-icons prefix">stars</i>
                            <input class="validate" id="rating" name="rating" type="text">
                            <label for="rating"></label>
                        </div>
                    </div>


                    <div class="row">

                        <div class="input-field col s4">
                            <i class="material-icons prefix">add_shopping_cart</i>
                            <select id="packingtype" name="packingtype">
                                <option disabled selected value="">Choose your option</option>
                                <option>Box</option>
                                <option>Strip</option>
                                <option>Sachets</option>
                                <option>Injections</option>
                                <option>Syrups</option>
                                <option>Packet</option>
                                <option>Bottle</option>
                            </select>
                            <label for="packingtype">Packing Type</label>
                        </div>

                        <div class="input-field col s4">
                            <i class="material-icons prefix">add_shopping_cart</i>
                            <select id="productstatus" name="productstatus">
                                <option disabled selected value="">Choose your option</option>
                                <option>Top-Selling</option>
                                <option>Trending</option>
                                <option>Best Seller</option>
                            </select>
                            <label for="productstatus">Status</label>
                        </div>

                        <div class="input-field col s4">
                            <i class="material-icons prefix">add_shopping_cart</i>
                            <select id="productsalestatus" name="productsalestatus">
                                <option disabled selected value="">Choose your option</option>
                                <option>Continue</option>
                                <option>Discontinue</option>
                            </select>
                            <label for="productsalestatus">Sale Status</label>
                        </div>

                    </div>

                </div>


                <div class="row ">
                    <div class="col s6 btnrow">
                        <button class="btn waves-effect waves-light btnstyle editbtn">Edit
                            <i class="material-icons right">edit</i>
                        </button>
                    </div>

                    <div class="col s6 btnrow">
                        <button class="btn waves-effect waves-white btnsize red btnstyle delbtn" type="button"
                            id="delbtn">Remove
                            <i class="material-icons right">delete</i>
                        </button>
                    </div>
                </div>

                <div class="row">
                    <div class="col s12 btnrow">
                        <span class="messagestyle" id="message">{{message}}</span>
                    </div>
                </div>
                <div class="modal-footer">
                    <a class="btnclose waves-effect waves-green btn-flat" href="#!">Close</a>
                </div>

            </div>
        </div>
    </div>
    </form>

    </div>

    </div>


    <!-- Modal Structure For Picture -->
    <div id="modal2" class="modal" style="width:400px; max-height: 700px;">
        <div class="modal-content">
            <div style="padding: 10px;">
                <input type="hidden" id="icon_pid" />
                <img id="icon" width="325" height="250"/>
            </div>
            <div style="padding: 15px;"><b>Select New Picture:</b></div>
            <div style="padding: 15px">
                <div class="file-field input-field">
                    <div class="btn">
                        <span>File</span>
                        <input required type="file" id="newicon">
                    </div>
                    <div class="file-path-wrapper">
                        <input class="file-path validate" type="text">
                    </div>
                </div>

                <button class="btn waves-effect waves-light iconbtn">Edit Icon
                    <i class="material-icons right">edit</i>
                </button>
                <div class="row">
                    <div class="col s12 btnrow">
                        <div id="imessage" class="messagestyle"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a class="btnclose waves-effect waves-green btn-flat" href="#!">Close</a>
                </div>

            </div>
        </div>
    </div>


</body>
<!-- Compiled and minified JavaScript -->
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js">
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

<script>
    $(document).ready(function () {
        $('#modal1').modal();
        $('#modal2').modal();

        $('.editdeletebtn').click(function () {
            $('#message').html('')
            // alert($(this).attr('cid'))
            $('#categoryid').val($(this).attr('cid'))
            // alert($(this).attr('sid'))
            $('#subcategoryid').val($(this).attr('sid'))
            // alert($('#subcategoryid').val()) 

            $.getJSON("http://localhost:8000/fetchallsubcategoryjson", { categoryid: $('#categoryid').val() }, function (data) {
                var records = data.data
                // alert(JSON.stringify(records))
                records.map((item) => {

                    $('#subcategoryid').append($("<option>").text(item.subcategoryname).val(item.subcategoryid))
                })
                $('#subcategoryid').val($('#subcategoryid').val())
                $('select').formSelect();
            })



            $('#braid').val($(this).attr('bid'))
            alert($('#braid').val())
            $.getJSON("http://localhost:8000/fetchallbrandjson", { subcategoryid: $(this).attr('sid') }, function (data) {
                var records = data.data
                alert(JSON.stringify(records))
                records.map((item) => {

                    $('#braid').append($("<option>").text(item.brandname).val(item.brandid))
                })
                $('#braid').val($('#braid').val())
                $('select').formSelect();
            })
            $('#productid').val($(this).attr('productid'))
            $('#productname').val($(this).attr('productname'))
            $('#productprice').val($(this).attr('price'))
            $('#productofferprice').val($(this).attr('offerprice'))
            $('#quantity').val($(this).attr('quantity'))
            $('#rating').val($(this).attr('rating'))
            $('#packingtype').val($(this).attr('packingtype'))
            $('#productstatus').val($(this).attr('status'))
            $('#productsalestatus').val($(this).attr('salestatus'))
            $('select').formSelect()
        })


        $('.editbtn').click(function () {
            $.getJSON('http://localhost:8000/editproduct', {
                productid: $('#productid').val(),
                productname: $('#productname').val(),
                categoryid: $('#categoryid').val(),
                subcategoryid: $('#subcategoryid').val(),
                brandid: $('#braid').val(),
                productprice: $('#productprice').val(),
                productofferprice: $('#productofferprice').val(),
                packingtype: $('#packingtype').val(),
                quantity: $('#quantity').val(),
                rating: $('#rating').val(),
                productstatus: $('#productstatus').val(),
                productsalestatus: $('#productsalestatus').val()
            },
                function (data) {
                    if (data.result) {
                        $('#message').html('Product Updated Successfully...')
                    }
                    else {
                        $('#message').html('Failed to Update Product...')
                    }
                })
        })

        $('.delbtn').click(function () {
            $.getJSON('http://localhost:8000/deleteproduct', {
                productid: $('#productid').val()
            }, function (data) {
                if (data.result) {
                    $('#message').html("Record Deleted Successfully..")
                } else {
                    $('#message').html("Fail to  Delete Record..")
                }

            })

        })

        $('.btnclose').click(function () {

            $('#modal1').modal('close');
            window.location.reload('http://localhost:8000/displayallbrand')

        })


        $('.btniconclose').click(function () {

            $('#modal2').modal('close');
            window.location.reload('http://localhost:8000/displayallbrand')

        })

        $('.imgbtn').click(function () {
            alert($(this).attr('productid'))
            $('#icon_pid').val($(this).attr('productid'))
            $('#modal2').modal('open');
            $('#icon').attr('src', `/static/${$(this).attr('producticon')}`)
        })
    });


    $('.iconbtn').click(function () {
        var formData = new FormData()
        // alert($('#icon_pid').val())
        formData.append('productid', $('#icon_pid').val())
        var file = $('#newicon')[0].files
        if (file.length > 0)
            formData.append('producticon', file[0])

        $.ajax({
            url: '/editproductimage',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            },
            type: 'post',
            data: formData,
            contentType: false,
            processData: false,
            success: function (response) {
                if (response != 0) {
                    // alert(true)
                    $('#imessage').html("Icon Updated..")
                } else {
                    // alert(false)
                    $('#imessage').html("Failed to Update..")
                }
            }

        })
    })


</script>

</html>